{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Customer Account CloudWatch Event Rules",
  "Parameters": {
    "MonitorRole": {
      "Description": "Name of the cross-account Lambda role",
      "Type": "String",
      "Default": "XMonitorRole"
    },
    "TargetId": {
      "Description": "Central Account ID/Target ID",
      "Type": "String",
      "Default": ""
    }
  },
  "Resources": {
    "InternetGatewayRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Name": "InternetGatewayRule",
        "Description": "Event Rule to send events to the security monitoring account",
        "EventPattern": {
          "source": [
            "aws.ec2"
          ],
          "detail-type": [
            "AWS API Call via CloudTrail"
          ],
          "detail": {
            "eventSource": [
              "ec2.amazonaws.com"
            ],
            "eventName": [
              "AttachInternetGateway",
              "CreateInternetGateway"
            ]
          }
        },
        "State": "ENABLED",
        "Targets": [{
	  "Arn": { "Fn::Sub": "arn:${AWS::Partition}:events:${AWS::Region}:${TargetId}:event-bus/default" },
	  "Id": { "Fn::Sub": "${TargetId}"}
	}]
      }
    },
    "FederationRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Name": "FederationRule",
        "Description": "Event Rule to send events to the security monitoring account",
        "EventPattern": {
          "source": [
            "aws.iam"
          ],
          "detail-type": [
            "AWS API Call via CloudTrail"
          ],
          "detail": {
            "eventSource": [
              "iam.amazonaws.com"
            ],
            "eventName": [
              "AttachRolePolicy",
              "DeleteRole",
              "DeleteRolePermissionsBoundary",
              "DeleteRolePolicy",
              "DetachRolePolicy",
              "PutRolePolicy",
              "UpdateRole"
            ],
            "requestParameters": {
              "roleName": [
                "ADMINISTRATOR",
                "BUANALYST",
                "COMPUTE",
                "NETWORK",
                "PDEVELOPER",
                "PROVISIONING",
                "SECURITY",
                "TREADONLY",
                "WLDEVELOPER"
              ]
            }
          }
        },
        "State": "ENABLED",
        "Targets": [{
	  "Arn": { "Fn::Sub": "arn:${AWS::Partition}:events:${AWS::Region}:${TargetId}:event-bus/default" },
	  "Id": { "Fn::Sub": "${TargetId}"}
	}]
      }
    }
  }
}
